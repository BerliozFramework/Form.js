!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):(t=t||self).BerliozCollection=e(t.jQuery)}(this,function(t){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var l,r,c,n,u,e,s,a,d,f,h,g,p,m;return t=t&&t.hasOwnProperty("default")?t.default:t,l=t,r="add.collection.berlioz",c="added.collection.berlioz",n="delete.collection.berlioz",u="deleted.collection.berlioz",e="min.collection.berlioz",s="max.collection.berlioz",a="click.add.collection.berlioz",d="click.delete.collection.berlioz",f='[data-add="collection"]',h='[data-delete="collection"]',g="[data-collection]",p="[data-collection-key]",m=function(){function a(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),this.target=l(t)}return function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(a,[{key:"addElement",value:function(){var t=this._nbElements(),e=l('<div data-collection-key="'+t+'"></div>'),n=this.target.data("prototype").replace(/___name___/g,t);if(!this._controlMaximum()){var o=l.Event(r);if(this.target.trigger(o),!o.isPropagationStopped()){e.append(l(n));var i=l(p,this.target).last();1===i.length?e.insertAfter(i):this.target.prepend(e),this.target.trigger(c),this._controlMaximum()}}}},{key:"deleteElement",value:function(t){if(void 0===(t=l(t)).data("collection-key")&&(t=t.parents(p)),0!==t.length&&!this._controlMinimum()){var e=l.Event(n);if(this.target.trigger(e),!e.isPropagationStopped()){t.remove();var o=this.target.data("collection"),i=a._escapeRegExp(this.target.data("collection")),r=this.target.attr("id");l(p,this.target).each(function(n){l(this).attr("data-collection-key",n),l("input, select, textarea, label",this).each(function(){var t=new RegExp(r+"_\\d+"),e=new RegExp(i+"\\[\\d+");l(this)[0].hasAttribute("for")&&l(this).attr("for",l(this).attr("for").replace(t,r+"_"+n)),l(this)[0].hasAttribute("name")&&l(this).attr("name",l(this).attr("name").replace(e,o+"["+n)),l(this)[0].hasAttribute("id")&&l(this).attr("id",l(this).attr("id").replace(t,r+"_"+n))})}),this.target.trigger(u),this._controlMinimum()}}}},{key:"_nbElements",value:function(){return l(p,this.target).length}},{key:"_controlMinimum",value:function(){return(this.target.data("collectionMin")||0)>=this._nbElements()&&(this.target.trigger(e),!0)}},{key:"_controlMaximum",value:function(){var t=this.target.data("collectionMax")||null;return null!==t&&t<=this._nbElements()&&(this.target.trigger(s),!0)}}],[{key:"_escapeRegExp",value:function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},{key:"_jQueryInterface",value:function(e,n){this.each(function(){var t=l(this).data("collection-object");switch("object"===o(t)&&t instanceof a||l(this).data("collection-object",t=new a(this)),e){case"add":t.addElement();break;case"delete":t.deleteElement(n)}})}}]),a}(),l.fn.berliozCollection=m._jQueryInterface,l.fn.berliozCollection.noConflict=function(){return m._jQueryInterface},void l(document).off(a,f).on(a,f,function(t){l(t.currentTarget).parents(g).berliozCollection("add")}).off(d,h).on(d,h,function(t){l(t.currentTarget).parents(g).berliozCollection("delete",l(t.currentTarget).parents(p))})});