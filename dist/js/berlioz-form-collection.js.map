{"version":3,"file":"berlioz-form-collection.js","sources":["../../src/js/berlioz-form-collection.js"],"sourcesContent":["import $ from 'jquery'\n\nconst BerliozCollection = (($) => {\n    /**\n     * Events.\n     */\n    const Event = {\n        ADD: 'add.collection.berlioz',\n        ADDED: 'added.collection.berlioz',\n        DELETE: 'delete.collection.berlioz',\n        DELETED: 'deleted.collection.berlioz',\n        MIN: 'min.collection.berlioz',\n        MAX: 'max.collection.berlioz',\n        // Selectors\n        CLICK_ADD: 'click.add.collection.berlioz',\n        CLICK_DELETE: 'click.delete.collection.berlioz'\n    };\n\n    /**\n     * Selectors.\n     */\n    const Selector = {\n        DATA_ADD: '[data-add=\"collection\"]',\n        DATA_DELETE: '[data-delete=\"collection\"]',\n        COLLECTION: '[data-collection]',\n        COLLECTION_KEY: '[data-collection-key]'\n    };\n\n    /**\n     * Collection class.\n     */\n    class Collection {\n        constructor(target) {\n            this.target = $(target);\n            this.index = this._getCollectionItems().last().attr('data-collection-key') || -1;\n        }\n\n        addElement() {\n            // Count the total element count in the collection\n            let newIndex = this.index + 1;\n            let newElement = $('<div data-collection-key=\"' + newIndex + '\"></div>');\n            let prototypeString = this.target.data('prototype').replace(/___name___/g, newIndex);\n\n            // Control maximum\n            if (this._controlMaximum()) {\n                return;\n            }\n\n            // ADD event\n            let eventAdd = $.Event(Event.ADD);\n            this.target.trigger(eventAdd);\n\n            if (!eventAdd.isDefaultPrevented()) {\n                newElement.append($(prototypeString));\n\n                let lastElement = this._getCollectionItems().last();\n                if (lastElement.length === 1) {\n                    newElement.insertAfter(lastElement);\n                } else {\n                    this.target.prepend(newElement);\n                }\n\n                this.index = newIndex;\n\n                // ADDED event\n                this.target.trigger(Event.ADDED);\n            }\n        }\n\n        deleteElement(element) {\n            element = $(element);\n\n            // If the element doesn't have the key attribute, it may be a child element of the item, so we try to get\n            // the item base element from its parents\n            if (typeof element.data('collection-key') === 'undefined') {\n                element = element.closest(Selector.COLLECTION_KEY);\n            }\n\n            // If no element found!\n            if (element.length === 0) {\n                return;\n            }\n\n            // Control minimum\n            if (this._controlMinimum()) {\n                return;\n            }\n\n            // DELETE event\n            let eventDelete = $.Event(Event.DELETE);\n            this.target.trigger(eventDelete);\n\n            if (!eventDelete.isDefaultPrevented()) {\n                element.remove();\n\n                // DELETED event\n                this.target.trigger(Event.DELETED);\n            }\n        }\n\n        _nbElements() {\n            return this._getCollectionItems().length\n        }\n\n        _controlMinimum() {\n            let minElements = this.target.data('collectionMin') || 0;\n\n            if (minElements >= this._nbElements()) {\n                this.target.trigger(Event.MIN);\n\n                return true;\n            }\n\n            return false;\n        }\n\n        _controlMaximum() {\n            let maxElements = this.target.data('collectionMax') || null;\n\n            if (maxElements !== null && maxElements <= this._nbElements()) {\n                this.target.trigger(Event.MAX);\n\n                return true;\n            }\n\n            return false;\n        }\n\n        _getCollectionItems() {\n            return this.target.children(Selector.COLLECTION_KEY);\n        }\n\n        static _escapeRegExp(string) {\n            return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n        }\n\n        static _jQueryInterface(action, arg1) {\n            this.each(function () {\n                let collectionObj = $(this).data('collection-object');\n\n                if (!(typeof collectionObj === 'object' && collectionObj instanceof Collection)) {\n                    $(this).data('collection-object', collectionObj = new Collection(this));\n                }\n\n                switch (action) {\n                    case 'add':\n                        collectionObj.addElement();\n                        break;\n                    case 'delete':\n                        collectionObj.deleteElement(arg1);\n                        break;\n                }\n            })\n        }\n    }\n\n    $.fn.berliozCollection = Collection._jQueryInterface;\n    $.fn.berliozCollection.noConflict = function () {\n        return Collection._jQueryInterface;\n    };\n\n    // Events\n    $(document)\n        .off(Event.CLICK_ADD, Selector.DATA_ADD)\n        .on(Event.CLICK_ADD,\n            Selector.DATA_ADD,\n            (event) => {\n                let target = $(event.currentTarget);\n                let collection;\n                if (target.data('target')) {\n                    collection = $('[data-collection=\"' + target.data('target') + '\"]');\n                } else {\n                    collection = target.closest(Selector.COLLECTION);\n                }\n                collection.berliozCollection('add');\n            })\n        .off(Event.CLICK_DELETE, Selector.DATA_DELETE)\n        .on(Event.CLICK_DELETE,\n            Selector.DATA_DELETE,\n            (event) => {\n                $(event.currentTarget)\n                    .parents(Selector.COLLECTION)\n                    .berliozCollection('delete', $(event.currentTarget).parents(Selector.COLLECTION_KEY));\n            })\n})($);\n\nexport default BerliozCollection\n"],"names":["BerliozCollection","$","Event","ADD","ADDED","DELETE","DELETED","MIN","MAX","CLICK_ADD","CLICK_DELETE","Selector","DATA_ADD","DATA_DELETE","COLLECTION","COLLECTION_KEY","Collection","target","index","_getCollectionItems","last","attr","newIndex","newElement","prototypeString","data","replace","_controlMaximum","eventAdd","trigger","isDefaultPrevented","append","lastElement","length","insertAfter","prepend","element","closest","_controlMinimum","eventDelete","remove","minElements","_nbElements","maxElements","children","string","action","arg1","each","collectionObj","addElement","deleteElement","fn","berliozCollection","_jQueryInterface","noConflict","document","off","on","event","currentTarget","collection","parents"],"mappings":"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"}