{"version":3,"file":"berlioz-form-collection.js","sources":["../../src/js/berlioz-form-collection.js"],"sourcesContent":["import $ from 'jquery'\r\n\r\nconst BerliozCollection = (($) => {\r\n    class Collection {\r\n        constructor(target) {\r\n            this.target = $(target);\r\n        }\r\n\r\n        addElement() {\r\n            // Count the total element count in the collection\r\n            let newCount = this.target.find('[data-collection-key]').length;\r\n            let newElement = $('<div data-collection-key=\"' + newCount + '\"></div>');\r\n            let prototypeString = this.target.data('prototype').replace(/___name___/g, newCount);\r\n            \r\n            newElement.append($(prototypeString));            \r\n            this.target.append(newElement);\r\n        }\r\n\r\n        deleteElement(element) {\r\n            element = $(element);\r\n\r\n            // If the element doesn't have the key attribute, it may be a child element of the item, so we try to get\r\n            // the item base element from its parents\r\n            if(!element.data('collection-key')) {\r\n                element = element.parents('[data-collection-key]');\r\n            }\r\n\r\n            let collection = $(element.parents('[data-collection]'));\r\n            element.remove();\r\n\r\n            // Update the indexes on each element\r\n            let collectionName = collection.data('collection');\r\n            let collectionNameEscaped = this.escapeRegExp(collection.data('collection'));\r\n            let collectionId = collection.attr('id');\r\n\r\n            $('[data-collection-key]', collection).each(function(index) {\r\n                $(this).attr('data-collection-key', index);\r\n\r\n                $('input, select, textarea, label', this).each(function () {\r\n                    let idPattern = new RegExp(collectionId + '_\\\\d+');\r\n                    let namePattern = new RegExp(collectionNameEscaped + '\\\\[\\\\d+');\r\n\r\n                    if ($(this)[0].hasAttribute('for')) {\r\n                        $(this).attr('for', $(this).attr('for').replace(idPattern, collectionId + '_' + index));\r\n                    }\r\n\r\n                    if ($(this)[0].hasAttribute('name')) {\r\n                        $(this).attr('name', $(this).attr('name').replace(namePattern, collectionName + '[' + index));\r\n                    }\r\n                    if ($(this)[0].hasAttribute('id')) {\r\n                        $(this).attr('id', $(this).attr('id').replace(idPattern, collectionId + '_' + index));\r\n                    }\r\n                });\r\n\r\n            });\r\n        }\r\n\r\n        escapeRegExp(string) {\r\n            return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\r\n        }\r\n\r\n        static _jQueryInterface(action, arg1) {\r\n            this.each(function() {\r\n                if(!(typeof $(this).data('collection-object') === 'object' && $(this).data('collection-object') instanceof Collection)) {\r\n                    $(this).data('collection-object', new Collection(this));\r\n                }\r\n    \r\n                switch(action) {\r\n                    case 'add':\r\n                        $(this).data('collection-object').addElement();\r\n                        break;\r\n                    case 'delete':\r\n                        $(this).data('collection-object').deleteElement(arg1);\r\n                        break;\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    $.fn.berliozCollection = Collection._jQueryInterface;\r\n    $.fn.berliozCollection.noConflict = function(){\r\n        return Collection._jQueryInterface;\r\n    }\r\n})($);\r\n\r\nexport default BerliozCollection;"],"names":["BerliozCollection","$","Collection","target","newCount","find","length","newElement","prototypeString","data","replace","append","element","parents","collection","remove","collectionName","collectionNameEscaped","escapeRegExp","collectionId","attr","each","index","idPattern","RegExp","namePattern","hasAttribute","string","action","arg1","addElement","deleteElement","fn","berliozCollection","_jQueryInterface","noConflict"],"mappings":"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"}