{"version":3,"file":"collection.js","sources":["../src/Event.js","../src/Collection.js"],"sourcesContent":["const triggerEvent = (type, element, args) => {\n    const event = new CustomEvent(type, {cancelable: true})\n\n    if (args) {\n        Object.keys(args)\n            .forEach((key) => Object.defineProperty(event,\n                key,\n                {\n                    get() {\n                        return args[key]\n                    }\n                }));\n    }\n\n    element.dispatchEvent(event);\n\n    return event;\n};\n\nexport default triggerEvent;\n","import triggerEvent from \"./Event\";\n\nconst Event = {\n    ADD: 'add.collection.berlioz',\n    ADDED: 'added.collection.berlioz',\n    DELETE: 'delete.collection.berlioz',\n    DELETED: 'deleted.collection.berlioz',\n    MIN: 'min.collection.berlioz',\n    MAX: 'max.collection.berlioz',\n    CLICK_ADD: 'click.add.collection.berlioz',\n    CLICK_DELETE: 'click.delete.collection.berlioz'\n};\n\nconst Selector = {\n    DATA_ADD: '[data-add=\"collection\"]',\n    DATA_REMOVE: '[data-delete=\"collection\"]',\n    COLLECTION: '[data-collection]',\n    COLLECTION_KEY: '[data-collection-key]'\n};\n\nconst Default = {\n    min: 0,\n    max: -1,\n    prototype: null,\n};\n\nclass Collection {\n    constructor(target, config) {\n        this._target = target;\n        this._config = {\n            ...Default,\n            ...this._configFromData(target),\n            ...config,\n        };\n        this._config.min = parseInt(this._config.min);\n        this._config.max = parseInt(this._config.max);\n        this._index = parseInt(this.lastItem ? this.lastItem.dataset.collectionKey || -1 : -1);\n\n        this._target._collection = this;\n    }\n\n    _configFromData(element) {\n        let config = {};\n\n        Object.keys(Default).forEach(function (key) {\n            let keyData = 'collection' + key.substring(0, 1).toUpperCase() + key.substring(1);\n\n            if (element.dataset.hasOwnProperty(keyData)) {\n                config[key] = element.dataset[keyData];\n            }\n        });\n\n        return config;\n    }\n\n    get target() {\n        return this._target;\n    }\n\n    get config() {\n        return this._config;\n    }\n\n    get items() {\n        return Array.from(this.target.querySelectorAll(Selector.COLLECTION_KEY))\n            .filter((element) => element.closest(Selector.COLLECTION) === this.target);\n    }\n\n    get index() {\n        return this._index;\n    }\n\n    get firstItem() {\n        return this.items[0] || null;\n    }\n\n    get lastItem() {\n        const items = this.items;\n\n        return items[items.length - 1] || null;\n    }\n\n    add() {\n        if (!this.config.prototype) {\n            console.warn('No prototype declared for collection, unable to add item');\n            return;\n        }\n\n        if (this.isFull()) {\n            return;\n        }\n\n        let tpl = document.createElement('div');\n        tpl.dataset.collectionKey = (++this._index).toString();\n        tpl.innerHTML = this.config.prototype.replace(/___name___/g, this._index);\n\n        // ADD event\n        let event = triggerEvent(Event.ADD, this.target);\n\n        if (!event.defaultPrevented) {\n            // Insert after last element or to the end\n            if (this.lastItem) {\n                this.lastItem.after(tpl);\n            } else {\n                this.target.append(tpl);\n            }\n\n            triggerEvent(Event.ADDED, this.target, {relatedTarget: tpl});\n        }\n    }\n\n    remove(element) {\n        // If the element doesn't have the key attribute, it may be a child element of the item, so we try to get\n        // the item base element from its parents\n        if (!element.matches(Selector.COLLECTION_KEY)) {\n            if (!(element = element.closest(Selector.COLLECTION_KEY))) {\n                if (element.closest(Selector.COLLECTION) !== this.target) {\n                    console.warn('Try to remove a non item');\n                    return;\n                }\n            }\n        }\n\n        // DELETE event\n        let event = triggerEvent(Event.DELETE, this.target, {relatedTarget: element});\n\n        if (this.isMin()) {\n            return;\n        }\n\n        if (!event.defaultPrevented) {\n            element.parentNode.removeChild(element);\n            triggerEvent(Event.DELETED, this.target, {relatedTarget: element});\n        }\n    }\n\n    isMin() {\n        if (this.config.min > -1 && this.config.min >= this.items.length) {\n            triggerEvent(Event.MIN, this.target, {relatedTarget: this.target});\n            return true;\n        }\n\n        return false;\n    }\n\n    isFull() {\n        if (this.config.max > -1 && this.config.max <= this.items.length) {\n            triggerEvent(Event.MAX, this.target, {relatedTarget: this.target});\n            return true;\n        }\n\n        return false;\n    }\n}\n\n\n// Events\ndocument.addEventListener('click', (event) => {\n    let button = event.target.closest(Selector.DATA_ADD);\n    if (!button) {\n        return;\n    }\n\n    let collection;\n    if (button.dataset.target) {\n        if (!(collection = document.querySelector(button.dataset.target))) {\n            collection = document.querySelector('[data-collection=\"' + button.dataset.target + '\"]');\n        }\n    } else {\n        collection = button.closest(Selector.COLLECTION);\n    }\n\n    if (collection && collection._collection) {\n        collection._collection.add();\n    }\n});\ndocument.addEventListener('click', (event) => {\n    let button = event.target.closest(Selector.DATA_REMOVE);\n    if (!button) {\n        return;\n    }\n\n    let collectionItem = button.closest(Selector.COLLECTION_KEY);\n\n    if (collectionItem) {\n        let collection = collectionItem.closest(Selector.COLLECTION);\n\n        if (collection && collection._collection) {\n            collection._collection.remove(collectionItem);\n        }\n    }\n});\n\nexport default Collection;\n"],"names":["triggerEvent","type","element","args","event","CustomEvent","cancelable","Object","keys","forEach","key","defineProperty","get","dispatchEvent","Event","ADD","ADDED","DELETE","DELETED","MIN","MAX","CLICK_ADD","CLICK_DELETE","Selector","DATA_ADD","DATA_REMOVE","COLLECTION","COLLECTION_KEY","Default","min","max","prototype","Collection","target","config","_target","_config","_configFromData","parseInt","_index","lastItem","dataset","collectionKey","_collection","keyData","substring","toUpperCase","hasOwnProperty","Array","from","querySelectorAll","filter","closest","items","length","console","warn","isFull","tpl","document","createElement","toString","innerHTML","replace","defaultPrevented","after","append","relatedTarget","matches","isMin","parentNode","removeChild","addEventListener","button","collection","querySelector","add","collectionItem","remove"],"mappings":"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"}